name: Test After Permissions Fix

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test-permissions:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Test repository access
      run: |
        echo "🔐 Testing repository access after permissions fix"
        echo "=================================================="
        echo "Repository: ${{ github.repository }}"
        echo "Owner: ${{ github.repository_owner }}"
        echo "Actor: ${{ github.actor }}"
        echo "Event: ${{ github.event_name }}"
        echo ""

    - name: Test external actions
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'

    - name: Test file operations
      run: |
        echo "📁 Testing file operations..."
        ls -la
        echo ""
        echo "Testing sait directory:"
        ls -la sait/ | head -10

    - name: Test npm operations
      working-directory: ./sait
      run: |
        echo "📦 Testing npm operations..."
        npm install --dry-run  # Только проверка, без установки
        echo "✅ npm commands work!"

    - name: Test artifact upload
      uses: actions/upload-artifact@v4
      with:
        name: test-artifact
        path: README.md
        retention-days: 1

    - name: Success message
      run: |
        echo "🎉 All tests passed!"
        echo ""
        echo "✅ Repository access: OK"
        echo "✅ External actions: OK"
        echo "✅ File operations: OK"
        echo "✅ npm operations: OK"
        echo "✅ Artifact upload: OK"
        echo ""
        echo "🚀 GitHub Actions permissions are working correctly!"
        echo "   You can now run the full CI/CD pipeline."
